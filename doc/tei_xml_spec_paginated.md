# TEI “Paginated Shape” — Minimal Spec

**Audience:** non-experts
**Goal:** a very small TEI/XML subset for page-accurate transcriptions of Tibetan works.
**Character set:** Unicode (UTF-8).
**Namespace:** `http://www.tei-c.org/ns/1.0`

This document describes the XML format that is expected in the BDRC etext archive.

The format is a small subset of [TEI/XML](https://tei-c.org/). This document only describes the `<body>` part of the document, for the description of the header and the folder structure, see [README.md](README.md).

Note that the content of the document must be normalized in the following way:
- spaces normalization:
   * no spaces at the beginning or end of lines
   * no empty lines
   * no BOM
   * all spaces should be ASCII space (no tabs)
   * no consecutive spaces
   * possibly use [this function](https://github.com/buda-base/tibetan-etext-tools/blob/main/DKCC/normalization.py#L31)
- non-Tibetan should be encoded in NFC (normalized form C), possibly using [this function](https://github.com/buda-base/tibetan-etext-tools/blob/main/DKCC/normalization.py#L76)
- Tibetan should be normalized according to the rules of the pybo normalizer, possibly use [this function](https://github.com/buda-base/tibetan-etext-tools/blob/main/DKCC/normalization.py#L229)

---

## 1) The smallest valid file

```xml
<?xml version="1.0" encoding="UTF-8"?>
<TEI xmlns="http://www.tei-c.org/ns/1.0">
  <text>
    <body xml:lang="bo">
      <p xml:space="preserve">
<pb n="1a"/>
<lb/>༄༅། །ཆོས་མངོན་པ་མཛོད་ཀྱི་འགྲེལ་པ་མངོན་པའི་རྒྱན་གྱི་དཀར་ཆག་དང་ས་བཅད་གླེང་བརྗོད་བཅས་བཞུགས་སོ༎
<pb n="1b"/>
<lb/>༄༅། །ཨོཾ་སྭ་སྟི། །གང་གི་མཚན་ཙམ་ལན་ཅིག་ཐོས་པས་ཀྱང་། །མཚམས་མེད་ལས་ལ་སྤྱོད་པའི་སྡིག་ཅན་ཡང་། །ཕྱི་མ་ངན་འགྲོའི་འཇིགས་ལས་སྐྱོབ་མཛད་
<pb n="2a"/>
<lb/>༄༅། །དབྱེ་བ་དང་། མཚན་ཉིད་དང་། དགོས་པ་དང་། གྲངས་ངེས་དང་། གོ་རིམས་ངེས་པ་ལྔ་བཤད་པ།
</p>
    </body>
  </text>
</TEI>
```

**Why `xml:space="preserve"`?**

Because we want to keep all spaces and line starts exactly as typed, which is not the default behavior of XML. Do **not** indent lines or wrap lines inside this `<p>`.

In XML, whitespace that appears between elements or around inline markup is usually non-semantic, so `<a>b</a>c` and `<a>b</a> c` are typically equivalent, which is not ideal if we want to keep a space before `c`. The attribute `xml:space="preserve"` changes that default by explicitly signaling that whitespace must be kept exactly as written, making spaces and newlines significant for processing and rendering.

**Consequences of `xml:space="preserve"`**

Unfortunately most xml libraries do not handle `xml:space="preserved"` very well, especially at generation. This means that the xml need to be generated by string manipulation instead of xml manipulation, and then validated against XML grammar and these specific rules.

---

## 2) High-level rules

1. **Structure (fixed skeleton)**

   * `<TEI><text><body><p xml:space="preserve">…</p></body></text></TEI>`
   * Put the whole transcript inside **one** `<p xml:space="preserve">`.
   * Default language: `<body xml:lang="bo">` (Tibetan). Use other `xml:lang` on elements when needed (e.g., English notes).

2. **Pagination and line breaks**

   * **Page/folio break:** `<pb n="1a"/>`, `<pb n="1b"/>`, `<pb n="2a"/>`, etc.

     * `n` is a string you copy from the source (e.g., folio+side). Use **a/b** for recto/verso if applicable.
     * Place `<pb/>` **before** the first line of that page.
   * **Line break:** `<lb/>` before each line’s text on that page.
   * Do **not** put text inside `<pb>` or `<lb>`; they are **empty** elements.

3. **Whitespace**

   * Keep all spaces and line starts (because of `xml:space="preserve"`).
   * Do not add or remove spaces around `<pb/>` and `<lb/>`.

4. **Unicode & punctuation**

   * Use proper Tibetan Unicode characters.
   * If you need XML special characters in notes or captions, escape them:

     * `&` → `&amp;`, `<` → `&lt;`, `>` → `&gt;`.

5. **Namespace**

   * Always include: `xmlns="http://www.tei-c.org/ns/1.0"` on `<TEI>`.

---

## 4) Content annotations (editorial & visual)

These can appear **inside the `<p>`**, between `<lb/>` and text, or wrapping spans of text.

### 4.1 Notes

* Editorial notes (e.g., explanations, glosses)
* Use `xml:lang` for the language of the note.

```xml
<note type="editorial" xml:lang="en">Correction by editor.</note>
```

### 4.1 Text & chapters indication

* typically used to indicate the start of a text

```xml
<milestone xml:id="XXX" unit="section"/>
```

replace XXX with anything that will help identify the text (ex: `D34` for the text 34 in the Derge Kangyur). Always use `section` as the unit.

### 4.2 Figure caption (no image embedding here)

* For captions or titles of illustrations.

```xml
<figure>
  <head xml:lang="bo">རིས་ཀྱི་མཚན་བྱང་།</head>
</figure>
```

### 4.3 Illegible or missing text

* **Completely unreadable:** use `gap` with a reason and units.

  * `unit="syllable"` and `quantity="N"` (estimated syllables).

```xml
<gap reason="illegible" unit="syllable" quantity="1"/>
```

* **Unclear but reconstructable:** wrap what you read/reconstruct in `unclear`.

  * Add `reason="illegible"` and optional `cert="low|medium|high"`.

```xml
<unclear reason="illegible" cert="low">བོད་</unclear>
```

### 4.4 Small-letter (yigchung)

```xml
<hi rend="small">ཡིག་ཆུང་།</hi>
```

### 4.5 Editorial emendations

##### 4.5.1 correction

Use a `choice` to show original vs corrected reading.

```xml
<choice><orig>བླ་མ་</orig><corr cert="low">བླ་མ།</corr></choice>
```

* `cert` on `<corr>` is optional; use when uncertain.

##### 4.5.2 regularization

Use a `choice` to show original vs regularized reading.

```xml
<choice><orig>རི་དགས</orig><reg>རི་དྭགས</reg></choice>
```

Use this typically for archaic or regional spellings.

##### 4.5.3 abbreviation expansion

Use a `choice` to show abbreviated (སྐུང་ཡིག) vs expanded reading.

```xml
<choice><abbr>ཀེུན</abbr><expan>ཀུན་མཁྱེན</expan></choice>
```

### 4.6 Modern styling (from modern sources)

* Italic: `<hi type="italic">…</hi>`
* Bold: `<hi type="bold">…</hi>`
* Headings: `<hi type="head">…</hi>` or levels: `head_1`, `head_2`, …

```xml
<hi type="italic">བོད་</hi>
<hi type="bold">ཡིག</hi>
<hi type="head">Title (general)</hi>
<hi type="head_1">Title Level 1</hi>
<hi type="head_2">Title Level 2</hi>
```

---

## 5) Element placement patterns

**Typical line with annotations**

```xml
<lb/>…normal text… <unclear reason="illegible">མཚན</unclear> … <note type="editorial" xml:lang="en">Place name</note>
```

**Line with a lacuna**

```xml
<lb/>…text… <gap reason="illegible" unit="syllable" quantity="2"/> …text…
```

**Page change mid-paragraph**

```xml
<lb/>…end of page text…
<pb n="12b"/>
<lb/>…start of next page…
```

**Caption separated from running text**

```xml
<lb/>…text referring to a figure…
<figure><head xml:lang="bo">རིས་ཀྱི་མཚན་</head></figure>
<lb/>…text continues…
```

--- 

## 6) Detailed formatting rules

- no empty file lines (here we call *file line* the lines in the xml files, delimited with `\n`, not xml markup `<lb/>`)
- file should be encoded in UTF8 with no BOM and use `\n` as end of line character
- no empty lines (`<lb/>\n`)
- all pages should start with a `<pb/>` (even the first one), all lines should start with `<lb/>`, even the first one
- `<pb/>` should always be the only thing in a file line (ex: no `<pb/><lb/>`)
- empty `<pb/>` are allowed
- if pagination (actual page number in the orginal) is not known, no `n="..."` attribute should be used in `<pb/>`
- each file line must start with `<lb/>` or `<pb/>`, no spaces or tabs before
- `<lb/>` and `<pb/>` tags should always be at the beginning of file lines
- no `<hi>` within `<hi>`
- no closing markup like `</hi>`, `</choice>`, etc. should be at the beginning of a line (ex: `<lb/></hi>`) or a page, it must be at the end of the previous line instead
- no opening markup or self-closing markup (like `<hi>`, `<milestone/>`, etc.) should be at the end of a line (ex: `...</hi>\n`) or a page, it must be at the beginning of the next line instead